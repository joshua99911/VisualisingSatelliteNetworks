<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://joshua99911.github.io/VisualisingSatelliteNetworks/Emulation/run_mn/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Run_MN - Visualising Satellite Networks</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Visualising Satellite Networks</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Emulation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../purpose/" class="dropdown-item">Purpose</a>
</li>
                                    
<li>
    <a href="../torus_topo/" class="dropdown-item">Torus_Topo</a>
</li>
                                    
<li>
    <a href="../simclient/" class="dropdown-item">simclient</a>
</li>
                                    
<li>
    <a href="../simapi/" class="dropdown-item">simapi</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Run_MN</a>
</li>
                                    
<li>
    <a href="../pmonitor/" class="dropdown-item">Pmonitor</a>
</li>
                                    
<li>
    <a href="../geosimsat/" class="dropdown-item">Geosimsat</a>
</li>
                                    
<li>
    <a href="../frr_topo/" class="dropdown-item">Frr_Topo</a>
</li>
                                    
<li>
    <a href="../frr_config_topo/" class="dropdown-item">Frr_Config_Topo</a>
</li>
                                    
<li>
    <a href="../driver/" class="dropdown-item">Driver</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Simulation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../Simulation/simulation/" class="dropdown-item">Simulation</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../Setup/" class="nav-link">Setup</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../DocStrings/" class="nav-link">DocStrings</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../simapi/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../pmonitor/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/joshua99911/VisualisingSatelliteNetworks/edit/master/docs/Emulation/run_mn.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#run_mn" class="nav-link">Run_MN</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn" class="nav-link">run_mn</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn.cleanup_dns" class="nav-link">cleanup_dns</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn.configure_dns" class="nav-link">configure_dns</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn.merge_captures" class="nav-link">merge_captures</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn.run" class="nav-link">run</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn.run_web_api" class="nav-link">run_web_api</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn.setup_packet_capture" class="nav-link">setup_packet_capture</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#emulation.mnet.run_mn.signal_handler" class="nav-link">signal_handler</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="run_mn">Run_MN</h1>


<div class="doc doc-object doc-module">



<a id="emulation.mnet.run_mn"></a>
    <div class="doc doc-contents first">

        <p>Run a mininet instance of FRR routers in a torus topology with namespace-aware traffic capture.</p>


<details class="command-line-options" open>
  <summary>Command-Line Options</summary>
  <ul>
<li><code>--cli</code>:
    Enable CLI (Command Line Interface) mode.</li>
<li><code>--no-mnet</code>:
    Disable Mininet simulation.</li>
<li><code>--monitor</code>:
    Enable monitoring functionality.</li>
</ul>
</details>

<details class="configuration-file" open>
  <summary>Configuration File</summary>
  <p>An optional INI-style file defining the following sections:</p>
<p>[network]
    - <code>rings</code> (int): Number of network rings (1-30). Default is 4.
    - <code>routers</code> (int): Number of routers per ring (1-30). Default is 4.
    - <code>ground_stations</code> (bool): Enable or disable ground stations. Default is False.</p>
<p>[monitor]
    - <code>stable_monitors</code> (bool): Enable or disable stable monitors. Default is False.</p>
</details>







  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="emulation.mnet.run_mn.cleanup_dns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cleanup_dns</span><span class="p">(</span><span class="n">net</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Clean up DNS configuration when the network is stopped.</p>

            <details class="quote">
              <summary>Source code in <code>emulation/mnet/run_mn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cleanup_dns</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean up DNS configuration when the network is stopped.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
        <span class="c1"># Remove the network namespace config directory</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm -rf /etc/netns/</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Restore original /etc/hosts</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;cp /etc/hosts.original /etc/hosts&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="emulation.mnet.run_mn.configure_dns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">configure_dns</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Configure DNS for all nodes in the network by updating /etc/hosts
in each node's namespace. Include interface IPs with descriptive names.</p>

            <details class="quote">
              <summary>Source code in <code>emulation/mnet/run_mn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">configure_dns</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Configure DNS for all nodes in the network by updating /etc/hosts</span>
<span class="sd">    in each node&#39;s namespace. Include interface IPs with descriptive names.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># First, collect all IP addresses and hostnames</span>
    <span class="n">hosts_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Add satellite nodes loopback addresses</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">torus_topo</span><span class="o">.</span><span class="n">satellites</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;ip&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">hosts_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Add interface IPs with descriptive names</span>
        <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">neighbor</span><span class="p">]</span>
            <span class="n">local_ip</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="n">remote_ip</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">][</span><span class="n">neighbor</span><span class="p">]</span>
            <span class="n">local_intf</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s2">&quot;intf&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="n">remote_intf</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s2">&quot;intf&quot;</span><span class="p">][</span><span class="n">neighbor</span><span class="p">]</span>

            <span class="c1"># Add entries for both local and remote interfaces</span>
            <span class="c1"># Format: IP    devicename-intf devicename-TO-neighborname</span>
            <span class="n">hosts_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">local_ip</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">local_intf</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-TO-</span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">hosts_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">remote_ip</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">remote_intf</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2">-TO-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Add ground stations</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">torus_topo</span><span class="o">.</span><span class="n">ground_stations</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;ip&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">hosts_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">format</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create hosts file content</span>
    <span class="n">hosts_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="s2">&quot;127.0.0.1</span><span class="se">\t</span><span class="s2">localhost&quot;</span><span class="p">,</span>
        <span class="s2">&quot;::1</span><span class="se">\t</span><span class="s2">localhost ip6-localhost ip6-loopback&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fe00::0</span><span class="se">\t</span><span class="s2">ip6-localnet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ff00::0</span><span class="se">\t</span><span class="s2">ip6-mcastprefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ff02::1</span><span class="se">\t</span><span class="s2">ip6-allnodes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ff02::2</span><span class="se">\t</span><span class="s2">ip6-allrouters&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Network hosts&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">hosts_entries</span>
    <span class="p">])</span>

    <span class="c1"># Update /etc/hosts in each node&#39;s namespace</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
        <span class="c1"># Create a temporary hosts file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/tmp/hosts.temp&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">hosts_content</span><span class="p">)</span>

        <span class="c1"># Copy the file to the node&#39;s namespace</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p /etc/netns/</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cp /tmp/hosts.temp /etc/netns/</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">/hosts&#39;</span><span class="p">)</span>

        <span class="c1"># Also update the current namespace&#39;s hosts file</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;cp /tmp/hosts.temp /etc/hosts&#39;</span><span class="p">)</span>

        <span class="c1"># Clean up</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;rm /tmp/hosts.temp&#39;</span><span class="p">)</span>

        <span class="c1"># Configure resolv.conf to use the hosts file</span>
        <span class="n">resolv_content</span> <span class="o">=</span> <span class="s2">&quot;nameserver 127.0.0.1</span><span class="se">\n</span><span class="s2">search mininet&quot;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo &quot;</span><span class="si">{</span><span class="n">resolv_content</span><span class="si">}</span><span class="s1">&quot; &gt; /etc/netns/</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">/resolv.conf&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo &quot;</span><span class="si">{</span><span class="n">resolv_content</span><span class="si">}</span><span class="s1">&quot; &gt; /etc/resolv.conf&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="emulation.mnet.run_mn.merge_captures" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_captures</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Merge all individual capture files into one.</p>

            <details class="quote">
              <summary>Source code in <code>emulation/mnet/run_mn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">merge_captures</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Merge all individual capture files into one.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">capture_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;mininet_captures&quot;</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">capture_dir</span> <span class="o">/</span> <span class="s2">&quot;torus_network.pcap&quot;</span>

    <span class="c1"># Find all temporary capture files</span>
    <span class="n">capture_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;capture_*.pcap&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">capture_files</span><span class="p">:</span>
        <span class="c1"># Use mergecap if available, otherwise use cat</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;which mergecap &gt;/dev/null 2&gt;&amp;1&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mergecap -w </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1"> /tmp/capture_*.pcap&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cat /tmp/capture_*.pcap &gt; </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Merged captures into </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Cleanup temporary files</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">capture_files</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="emulation.mnet.run_mn.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">num_rings</span><span class="p">,</span> <span class="n">num_routers</span><span class="p">,</span> <span class="n">use_cli</span><span class="p">,</span> <span class="n">use_mnet</span><span class="p">,</span> <span class="n">stable_monitors</span><span class="p">,</span> <span class="n">ground_stations</span><span class="p">,</span> <span class="n">enable_monitoring</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Execute the simulation of an FRR router network in a torus topology using Mininet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_rings</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of network rings to create (1-30).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_routers</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of routers per ring (1-30).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cli</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, enable the Mininet Command Line Interface (CLI).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_mnet</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, enable the Mininet simulation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stable_monitors</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to enable stable monitoring configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ground_stations</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, include ground stations in the topology.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enable_monitoring</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to enable traffic monitoring. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>This function creates a torus topology based on the specified parameters, configures DNS and
monitoring (if enabled), and starts the simulation. If the CLI is enabled, it allows interactive
control of the network. After the simulation, it cleans up the DNS configuration and stops the
network.</p>

            <details class="quote">
              <summary>Source code in <code>emulation/mnet/run_mn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">num_rings</span><span class="p">,</span> <span class="n">num_routers</span><span class="p">,</span> <span class="n">use_cli</span><span class="p">,</span> <span class="n">use_mnet</span><span class="p">,</span> <span class="n">stable_monitors</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">ground_stations</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">enable_monitoring</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Execute the simulation of an FRR router network in a torus topology using Mininet.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_rings (int): Number of network rings to create (1-30).</span>
<span class="sd">        num_routers (int): Number of routers per ring (1-30).</span>
<span class="sd">        use_cli (bool): If True, enable the Mininet Command Line Interface (CLI).</span>
<span class="sd">        use_mnet (bool): If True, enable the Mininet simulation.</span>
<span class="sd">        stable_monitors (bool): Whether to enable stable monitoring configurations.</span>
<span class="sd">        ground_stations (bool): If True, include ground stations in the topology.</span>
<span class="sd">        enable_monitoring (bool, optional): Whether to enable traffic monitoring. Defaults to False.</span>

<span class="sd">    This function creates a torus topology based on the specified parameters, configures DNS and</span>
<span class="sd">    monitoring (if enabled), and starts the simulation. If the CLI is enabled, it allows interactive</span>
<span class="sd">    control of the network. After the simulation, it cleans up the DNS configuration and stops the</span>
<span class="sd">    network.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Create a networkx graph annotated with FRR configs</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">torus_topo</span><span class="o">.</span><span class="n">create_network</span><span class="p">(</span><span class="n">num_rings</span><span class="p">,</span> <span class="n">num_routers</span><span class="p">,</span> <span class="n">ground_stations</span><span class="p">)</span>
    <span class="n">frr_config_topo</span><span class="o">.</span><span class="n">annotate_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">frr_config_topo</span><span class="o">.</span><span class="n">dump_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

    <span class="c1"># Use the networkx graph to build a mininet topology</span>
    <span class="n">topo</span> <span class="o">=</span> <span class="n">frr_topo</span><span class="o">.</span><span class="n">NetxTopo</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;generated topo&quot;</span><span class="p">)</span>

    <span class="n">net</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">use_mnet</span><span class="p">:</span>
        <span class="c1"># Backup original DNS files</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/hosts&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp /etc/hosts /etc/hosts.mininet.bak&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/resolv.conf&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp /etc/resolv.conf /etc/resolv.conf.mininet.bak&#39;</span><span class="p">)</span>

        <span class="n">net</span> <span class="o">=</span> <span class="n">Mininet</span><span class="p">(</span><span class="n">topo</span><span class="o">=</span><span class="n">topo</span><span class="p">)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Configure DNS after network starts but before monitoring</span>
        <span class="n">configure_dns</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;configured DNS&quot;</span><span class="p">)</span>

        <span class="c1"># Set up packet capture if monitoring is enabled</span>
        <span class="k">if</span> <span class="n">enable_monitoring</span><span class="p">:</span>
            <span class="c1"># Wait a moment for interfaces to be ready</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">setup_packet_capture</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>

    <span class="n">frrt</span> <span class="o">=</span> <span class="n">frr_topo</span><span class="o">.</span><span class="n">FrrSimRuntime</span><span class="p">(</span><span class="n">topo</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">stable_monitors</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;created runtime&quot;</span><span class="p">)</span>

    <span class="n">frrt</span><span class="o">.</span><span class="n">start_routers</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">****Running </span><span class="si">{</span><span class="n">num_rings</span><span class="si">}</span><span class="s2"> rings with </span><span class="si">{</span><span class="n">num_routers</span><span class="si">}</span><span class="s2"> per ring, stable monitors </span><span class="si">{</span><span class="n">stable_monitors</span><span class="si">}</span><span class="s2">, &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;ground_stations </span><span class="si">{</span><span class="n">ground_stations</span><span class="si">}</span><span class="s2">, monitoring </span><span class="si">{</span><span class="s1">&#39;enabled&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">enable_monitoring</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;disabled&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Open xterm for specific nodes</span>
    <span class="c1"># node_list = [net.get(&#39;G_PAO&#39;), net.get(&#39;G_SYD&#39;), net.get(&#39;R0_0&#39;)]  # Replace with your node names</span>
    <span class="c1"># for node in node_list:</span>
    <span class="c1">#     makeTerm(node, title=f&#39;Terminal for {node.name}&#39;)</span>
    <span class="c1">#     print(&quot;Made Terminal for &quot;, {node.name})</span>

    <span class="k">if</span> <span class="n">use_cli</span> <span class="ow">and</span> <span class="n">net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Launch the web interface in a separate thread</span>
        <span class="n">web_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_web_api</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">frrt</span><span class="p">,))</span>
        <span class="n">web_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">web_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Enter the CLI</span>
        <span class="n">CLI</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>

        <span class="c1"># Ensure the web thread continues running after exiting the CLI</span>
        <span class="n">web_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">run_web_api</span><span class="p">(</span><span class="n">frrt</span><span class="p">)</span>

    <span class="c1"># Cleanup before stopping</span>
    <span class="k">if</span> <span class="n">net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">enable_monitoring</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stopping packet capture...&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;pkill -f tcpdump&#39;</span><span class="p">)</span>
        <span class="n">merge_captures</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cleanup_dns</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="c1"># Restore original DNS files</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/hosts.mininet.bak&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp /etc/hosts.mininet.bak /etc/hosts&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm /etc/hosts.mininet.bak&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/resolv.conf.mininet.bak&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp /etc/resolv.conf.mininet.bak /etc/resolv.conf&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm /etc/resolv.conf.mininet.bak&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="emulation.mnet.run_mn.run_web_api" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_web_api</span><span class="p">(</span><span class="n">frrt</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Launch the web API in a separate thread.</p>

            <details class="quote">
              <summary>Source code in <code>emulation/mnet/run_mn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_web_api</span><span class="p">(</span><span class="n">frrt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Launch the web API in a separate thread.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Launching web API in a separate thread. Use /shutdown to halt.&quot;</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">frrt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="emulation.mnet.run_mn.setup_packet_capture" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_packet_capture</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set up packet capture within each router's network namespace.</p>

            <details class="quote">
              <summary>Source code in <code>emulation/mnet/run_mn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_packet_capture</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up packet capture within each router&#39;s network namespace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">capture_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;mininet_captures&quot;</span>
    <span class="n">capture_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting up packet capture in: </span><span class="si">{</span><span class="n">capture_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Ensure we have permission to write to the directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;chmod -R 777 </span><span class="si">{</span><span class="n">capture_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Kill any existing tcpdump processes</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;pkill -f tcpdump&#39;</span><span class="p">)</span>

    <span class="c1"># Create the tcpdump command template</span>
    <span class="c1"># Using -B 4096 to increase buffer size and prevent packet drops</span>
    <span class="n">tcpdump_cmd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;tcpdump -i any -s 0 -n -B 4096 -w /tmp/capture_</span><span class="si">{}</span><span class="s1">.pcap &#39;</span>
        <span class="s1">&#39;&quot;ip proto ospf or icmp or tcp or udp&quot; &#39;</span>
        <span class="s1">&#39;2&gt;/dev/null &amp;&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Start capture for each router</span>
    <span class="k">for</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="n">torus_topo</span><span class="o">.</span><span class="n">satellites</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="n">net</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">tcpdump_cmd</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started capture for </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Start capture for ground stations</span>
    <span class="k">for</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="n">torus_topo</span><span class="o">.</span><span class="n">ground_stations</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="n">net</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">tcpdump_cmd</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started capture for </span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Give tcpdump a moment to start</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Verify captures are running</span>
    <span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;ps aux | grep tcpdump&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;tcpdump -i any&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confirmed capture running on </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">running</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Packet capture successfully started on network namespaces&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Packet captures may not have started properly&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="emulation.mnet.run_mn.signal_handler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Make a ^C start a clean shutdown. Needed to stop all of the FRR processes.</p>

            <details class="quote">
              <summary>Source code in <code>emulation/mnet/run_mn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a ^C start a clean shutdown. Needed to stop all of the FRR processes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ctrl-C received, shutting down....&quot;</span><span class="p">)</span>
    <span class="c1"># Ensure tcpdump is stopped</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;pkill -f tcpdump&#39;</span><span class="p">)</span>
    <span class="c1"># Restore original DNS files if they exist</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/hosts.mininet.bak&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp /etc/hosts.mininet.bak /etc/hosts&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm /etc/hosts.mininet.bak&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/resolv.conf.mininet.bak&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cp /etc/resolv.conf.mininet.bak /etc/resolv.conf&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm /etc/resolv.conf.mininet.bak&#39;</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">invoke_shutdown</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
